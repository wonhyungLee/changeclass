# 스마트 반배정 마법사 v2.6 — 사용 설명서

엑셀(.xlsx/.xls/.csv)로 학생 명단을 업로드하면, **그룹(동반 배정)**과 **성비 균형**을 고려해 여러 반으로 자동 배정하고, 이후 **드래그/클릭으로 미세 조정**한 뒤 **엑셀로 저장**할 수 있는 브라우저용 도구입니다.

배포용(인쇄/PDF) 상세 안내서: `public/배포용_사용설명서.html` (Chrome/Edge에서 열고 `Ctrl+P` → PDF로 저장)

## 핵심 기능

- 그룹ID 기반 동반 배정 및 이동 시 그룹 유지/분리 선택
- 성비(남/여) 및 인원수 균형을 고려한 자동 배정
- 드래그(데스크톱) / 선택 이동(모바일)로 빠른 미세 조정
- 반 내부 동명이인 표시, 학생 검색/하이라이트, 보기/정렬 전환
- 결과 엑셀 저장 및 재업로드로 배정 상태 복구

## 목차

- [1) 빠른 시작](#1-빠른-시작사용-흐름)
- [2) 실행 방법](#2-실행-방법)
- [3) 입력 엑셀 준비](#3-입력-엑셀업로드-파일-준비-방법)
- [4) 자동 배정 규칙](#4-자동-배정-규칙핵심-로직)
- [5) 대시보드 사용법](#5-대시보드-사용법배정-후-화면)
- [6) 엑셀 저장/복구](#6-엑셀-저장복구중요)
- [7) 문제 해결](#7-문제-해결faq)
- [8) 개인정보/보안](#8-개인정보보안-안내)
- [9) 기술 정보](#9-기술-정보개발-참고)

---

## 1) 빠른 시작(사용 흐름)

1. **기초 자료 업로드**: 학생 명단 엑셀 파일 선택
2. **반 개수 설정**: 생성할 반 개수(2~15반) 선택
3. **배정 시작**: 자동 반배정 수행
4. **조정**: 학생 이동(드래그/선택) + 비고 입력 + 반 추가/삭제
5. **엑셀 저장**: `2025학년도_반배정결과.xlsx` 다운로드

> 중요: 새로고침하면 브라우저의 작업 내용이 초기화됩니다. 결과를 남기려면 반드시 **엑셀 저장**을 진행하세요.

---

## 2) 실행 방법

### 2-1. 일반 사용자(권장)

- 운영자가 제공한 **웹 주소(URL)** 로 접속해 사용합니다.
- 최신 **Chrome/Edge** 환경을 권장합니다.

### 2-2. 로컬에서 직접 실행(개발자/운영자)

사전 준비: **Node.js 18 이상**(권장 20 이상)

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev
```

빌드/미리보기:

```bash
npm run build
npm run preview
```

> 참고: `dist/` 결과물을 더블클릭으로 여는 방식(file://)은 보통 정상 동작하지 않습니다. 로컬/사내 서버로 제공하거나 `preview`처럼 서버로 실행하세요.

---

## 3) 입력 엑셀(업로드 파일) 준비 방법

### 3-1. 지원 파일

- `.xlsx`, `.xls`, `.csv`
- 첫 번째 시트(첫 탭)만 읽습니다.

### 3-2. 인식하는 주요 컬럼(헤더)

아래는 프로그램이 **자동으로 찾아 읽는 컬럼명**입니다. (대소문자/공백 변형 일부 허용)

| 목적 | 인식되는 컬럼명(예) | 설명 |
|---|---|---|
| 학생 이름 | `성명`, `이름` | 필수(둘 중 하나). 없으면 `이름없음`으로 표시됩니다. |
| 성별 | `성별` | `남`, `남성`, `여`, `여성`을 인식합니다(그 외는 기타로 처리). |
| 그룹(동반 배정) | `그룹ID`, `그룹id`, `GroupID` | 값이 같으면 **같은 반**으로 배정됩니다. (빈 값은 그룹 없음) |
| 비고 | `비고` | 학생 카드/상세에서 표시 및 수정(자동 저장). |
| 이전 정보(표시용) | `학년`, `반`, `번호`, `생년월일` | 배정 로직에는 직접 반영되지 않고 화면 표시(학생 카드/상세)에만 사용됩니다. |

### 3-3. 배정 결과 복구(재업로드)용 컬럼

저장한 결과 파일을 다시 올리면, 기존 배정 상태를 복구할 수 있습니다.

| 목적 | 인식되는 컬럼명(예) | 설명 |
|---|---|---|
| 이미 배정된 반 | `배정반`, `배정 반`, `배정`, `신반` | 숫자를 포함하면 인식합니다(예: `1`, `1반`, `3학급`). 업로드 시 곧바로 대시보드로 진입합니다. |
| 수동 이동 표시 | `수동이동여부`, `수동 이동 여부`, `수동이동` | 값이 있으면 수동 이동 표시가 유지됩니다. |

### 3-4. 입력 양식 예시(CSV)

```csv
성명,성별,학년,반,번호,그룹ID,비고,생년월일
홍길동,남,1,3,12,G1,형제/자매 동반,2012-03-14
김민지,여,1,3,8,G1,,2012-09-01
이서준,남,1,4,5,,주의: 알레르기,2012-05-22
```

---

## 4) 자동 배정 규칙(핵심 로직)

1. **그룹ID가 있는 학생**은 그룹 단위로 묶어 배정합니다. (그룹은 분리되지 않습니다)
2. **그룹이 없는 학생**은 성별(남/여/기타)로 나누어 섞은 뒤,
   - 해당 성별 인원이 가장 적은 반(동률이면 전체 인원이 더 적은 반)에 순차 배정하여 **성비와 인원수 균형**을 맞춥니다.
3. 배정에는 무작위 요소(섞기)가 있어, **재실행 시 결과가 달라질 수 있습니다.**

---

## 5) 대시보드 사용법(배정 후 화면)

### 5-1. 상단 버튼/기능

- **학생 이름 검색**: 이름 일부를 입력하면 해당 학생 카드가 강조 표시되고 나머지는 흐려집니다.
- **가나다순/배정순**: 반 내부 학생 목록을 이름순(가나다) 또는 배정된 순서로 전환합니다.
- **한눈에/카드형**: 화면 밀도를 전환합니다(대량 데이터에서 카드형이 유리).
- **재설정**: 같은 업로드 데이터로 다시 반 개수를 설정하여 자동 배정을 다시 수행합니다(현재 배정/수동 조정은 사라집니다).
- **엑셀 저장**: 현재 배정 상태를 엑셀로 다운로드합니다.

### 5-2. 학생 이동(반 변경)

데스크톱:
- 학생 카드를 **드래그하여 다른 반**에 놓으면 이동합니다.

모바일/공통:
- 학생 카드를 **클릭(터치)** 하면 상세 창이 열립니다.
- 상세 창의 **현재 배정(반 이동)** 드롭다운에서 목표 반을 선택해 이동합니다.

### 5-3. 그룹 이동/그룹 해제

- 그룹 학생을 이동할 때, 같은 반에 그룹원이 함께 있으면 **그룹 전체 이동** 여부를 묻습니다.
  - [확인] 그룹 전체를 함께 이동
  - [취소] 해당 학생만 이동(그룹 분리 이동)
- 학생 상세 창에서 **그룹 해제**를 누르면 해당 학생의 그룹 연결이 끊깁니다(되돌릴 수 없음).

### 5-4. 반 추가/삭제

- 화면 오른쪽의 **반 추가** 버튼으로 새 반을 만들 수 있습니다.
- 반에 학생이 없을 때만, 반 헤더의 휴지통 아이콘으로 **빈 반 삭제**가 가능합니다.

### 5-5. 표시/경고(알아두면 좋은 표식)

- 반 헤더에 `동명` 표시 또는 학생 이름 옆 경고 아이콘: **해당 반 내부에 동명이인이 있음**
- 파란 점: 자동 배정된 반에서 **수동으로 이동됨**
- 노란 점: **비고가 있음**
- 그룹 배지: **그룹ID가 있음(동반 배정 대상)**

### 5-6. 비고 입력(자동 저장)

- 학생 상세 창의 **비고 사항**을 수정하면 즉시 반영됩니다.
- 최종 보존은 **엑셀 저장**으로 완료됩니다.

---

## 6) 엑셀 저장/복구(중요)

### 6-1. 엑셀 저장

- 상단의 **엑셀 저장**을 누르면 `2025학년도_반배정결과.xlsx`가 다운로드됩니다.
- 파일에는 기존 원본 데이터 + `배정반`, `수동이동여부` 등이 포함되어 이후 복구에 사용됩니다.

### 6-2. 저장한 파일로 이어서 작업하기(복구)

- 저장한 결과 엑셀을 다시 업로드하면 `배정반`을 읽어 **기존 배정 상태로 바로 대시보드에 진입**합니다.

---

## 7) 문제 해결(FAQ)

### Q1. “엑셀 라이브러리가 로드되지 않았습니다” 라고 뜹니다.

- 현재 버전은 엑셀 처리 라이브러리를 실행 중에 불러옵니다.
- 학교/기관망에서 외부 CDN이 차단되어 있으면 업로드가 실패할 수 있습니다.
- 해결:
  - 네트워크(인터넷) 연결 상태 확인 후 재시도
  - 운영자가 내부망에서 사용할 수 있도록(라이브러리 포함 빌드 등) 배포 방식을 조정

### Q2. 업로드는 되는데 학생 정보가 비어 보입니다.

- 엑셀의 **첫 행 헤더(컬럼명)** 가 인식되는 이름인지 확인하세요(예: `성명`, `성별`, `그룹ID` 등).
- 첫 번째 시트에 데이터가 있는지 확인하세요.

### Q3. 남/여 통계가 이상합니다.

- 성별 값은 `남`/`남성`, `여`/`여성`만 통계로 분류됩니다.
- 다른 표기(예: `M/F`)는 “기타”로 처리됩니다.

---

## 8) 개인정보/보안 안내

- 학생 파일은 브라우저에서 읽고 화면에 배치되며, 별도 서버로 업로드하지 않습니다.
- 단, 엑셀 처리를 위한 외부 라이브러리를 내려받기 위해 네트워크 요청이 발생할 수 있습니다(차단 환경에서는 동작이 제한될 수 있음).

---

## 9) 기술 정보(개발 참고)

- Frontend: React + Vite + TailwindCSS
- 아이콘: lucide-react
- 엑셀 처리: SheetJS(xlsx)
